<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Metal Team City</title>
    <style>
        body { margin: 0; overflow: hidden; background: #111; font-family: sans-serif; touch-action: none; }
        canvas { display: block; width: 100vw; height: 100vh; background: #1a1a1a; }
        #menu { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10; text-align: center; }
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 20px; }
        .card { border: 2px solid #444; padding: 5px; border-radius: 10px; background: #222; width: 85px; min-height: 90px; }
        .card.selected { border-color: #0f0; background: #1a331a; }
        .card img { width: 55px; height: 55px; object-fit: contain; display: block; margin: 0 auto 5px; }
        button { padding: 15px 45px; background: #0f0; border: none; font-weight: bold; border-radius: 30px; font-size: 22px; color: black; box-shadow: 0 4px #080; }
        #ui { position: absolute; top: 10px; left: 10px; color: #0f0; font-family: monospace; z-index: 5; pointer-events: none; }
    </style>
</head>
<body>
    <div id="ui">SCORE: <span id="s">0</span> | BEST: <span id="b">0</span></div>
    <div id="menu">
        <h1 style="color:#0f0">METAL TEAM</h1>
        <div class="grid">
            <div class="card selected" id="c-james" onclick="sel('james')"><img src="james.png">James</div>
            <div class="card" id="c-key" onclick="sel('key')"><img src="key.png">Key</div>
            <div class="card" id="c-lock" onclick="sel('lock')"><img src="lock.png">Lock</div>
            <div class="card" id="c-g" onclick="sel('goldy')"><img src="goldy.png">Goldy</div>
            <div class="card" id="c-b" onclick="sel('bee')"><img src="bee.png">Bee</div>
        </div>
        <button onclick="go()">START</button>
    </div>
    <canvas id="g"></canvas>
<script>
const canvas = document.getElementById('g');
const ctx = canvas.getContext('2d');
const names = ['james', 'key', 'lock', 'goldy', 'bee'];
const sprites = {};

names.forEach(n => {
    sprites[n] = new Image();
    sprites[n].src = n + ".png";
});

let active = false; let score = 0; let lane = 1; let speed = 6;
let obs = []; let selected = 'james'; let timer = 0;
let high = localStorage.getItem('metal_best') || 0;
document.getElementById('b').innerText = high;

function sel(n) {
    selected = n;
    document.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
    const ids = {james:'c-james', key:'c-key', lock:'c-lock', goldy:'c-g', bee:'c-b'};
    document.getElementById(ids[n]).classList.add('selected');
}

function go() { document.getElementById('menu').style.display='none'; active=true; spawn(); loop(); }

function spawn() {
    if(!active) return;
    obs.push({x: Math.floor(Math.random()*3), y: -150});
    setTimeout(spawn, Math.max(350, 1000 - (speed * 10)));
}

window.addEventListener('touchstart', e => {
    if(!active) return;
    if(e.touches[0].clientX < window.innerWidth/2) { if(lane > 0) lane--; }
    else { if(lane < 2) lane++; }
});

function loop() {
    if(!active) return;
    ctx.fillStyle = '#111'; ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.strokeStyle='#333';
    for(let i=1;i<3;i++) { ctx.beginPath(); ctx.moveTo(i*(canvas.width/3),0); ctx.lineTo(i*(canvas.width/3),canvas.height); ctx.stroke(); }

    timer += 0.15; score++; speed += 0.002;
    const px = lane * (canvas.width/3) + (canvas.width/6);
    const py = canvas.height - 150 + Math.sin(timer)*8;

    obs.forEach((o, i) => {
        o.y += speed;
        ctx.fillStyle = '#555'; ctx.fillRect(o.x*(canvas.width/3)+20, o.y, (canvas.width/3)-40, 100);
        if(o.y > canvas.height) obs.splice(i,1);
        if(o.y > canvas.height-180 && o.y < canvas.height-80 && o.x === lane) {
            active = false; 
            if(Math.floor(score/10) > high) localStorage.setItem('metal_best', Math.floor(score/10));
            alert("Score: " + Math.floor(score/10)); location.reload();
        }
    });

    ctx.save(); ctx.translate(px, py); ctx.rotate(Math.sin(timer*0.8)*0.08);
    const s = sprites[selected];
    if(s.complete && s.naturalWidth !== 0) {
        ctx.drawImage(s, -45, -45, 90, 90);
    } else {
        ctx.fillStyle='#0f0'; ctx.beginPath(); ctx.arc(0,0,35,0,7); ctx.fill();
    }
    ctx.restore();
    document.getElementById('s').innerText = Math.floor(score/10);
    requestAnimationFrame(loop);
}
canvas.width = window.innerWidth; canvas.height = window.innerHeight;
</script>
</body>
</html>
